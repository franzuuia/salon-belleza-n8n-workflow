{"name":"Salón de Belleza - Sistema Completo","nodes":[{"parameters":{"updates":["messages"],"options":{}},"id":"f7b8cf85-ddc1-4444-bd62-5b2dc1a405e1","name":"WhatsApp Trigger","type":"n8n-nodes-base.whatsAppTrigger","typeVersion":1,"position":[0,0],"webhookId":"069e9e90-d4d3-4743-a564-a75c5af97388"},{"parameters":{"jsCode":"// Código para procesar los datos del webhook\nconst inputData = items[0].json;\n\n// Extraer información del webhook de WhatsApp\nconst messageData = inputData.entry?.[0]?.changes?.[0]?.value?.messages?.[0];\n\nif (!messageData) {\n  return {\n    json: {\n      error: true,\n      message: \"No message data found\",\n      debugInfo: { receivedData: inputData },\n      timestamp: new Date().toISOString()\n    }\n  };\n}\n\n// Extraer datos relevantes\nconst messageInfo = {\n  messageId: messageData.id,\n  messageContent: messageData.text?.body || \"\",\n  timestamp: messageData.timestamp,\n  type: messageData.type\n};\n\nconst contactInfo = {\n  whatsappNumber: messageData.from,\n  name: inputData.entry?.[0]?.changes?.[0]?.value?.contacts?.[0]?.profile?.name || \"Cliente\"\n};\n\n// Retornar la estructura procesada\nreturn {\n  json: {\n    messageInfo,\n    contactInfo,\n    error: false,\n    timestamp: new Date().toISOString(),\n    debugInfo: { receivedData: inputData }\n  }\n};"},"id":"5fe82922-1522-47bb-b038-b9a1a0e4dda8","name":"Procesar Mensaje","type":"n8n-nodes-base.code","typeVersion":2,"position":[220,0]},{"parameters":{"model":{"mode":"list","value":"gpt-4"},"options":{"temperature":0.2}},"id":"5853d1a6-826b-4bdd-b5db-677ea7fbe6b2","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[220,220]},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Procesar Mensaje').item.json.contactInfo.whatsappNumber }}"},"id":"67f63786-6c32-4d1c-8a45-529476183bc7","name":"Memoria Cliente","type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[400,220]}],"connections":{"WhatsApp Trigger":{"main":[[{"node":"Procesar Mensaje","type":"main","index":0}]]},"Procesar Mensaje":{"main":[[{"node":"AI Asistente","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Asistente","type":"ai_languageModel","index":0}]]},"Memoria Cliente":{"ai_memory":[[{"node":"AI Asistente","type":"ai_memory","index":0}]]}},"settings":{"executionOrder":"v1","saveManualExecutions":true,"callerPolicy":"workflowsFromSameOwner","errorWorkflow":"none"}}